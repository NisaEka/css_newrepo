#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run unit tests
# flutter test

# check formatting & fix problems & analyze code using lint_staged
dart run lint_staged

# Ensure pubspec.lock is up-to-date
flutter pub get

# Check if build_runner is available
if flutter pub run build_runner --version > /dev/null 2>&1; then
  echo "Running build_runner..."
  flutter packages pub run build_runner build --delete-conflicting-outputs
else
  echo "Skipping build_runner as it is not installed or not used."
fi

# Check for uncommitted changes in generated files
git diff --exit-code || {
  echo "Uncommitted changes detected. Please commit generated files.";
  exit 1;
}
